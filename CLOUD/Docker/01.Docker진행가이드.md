[Dstone Document Index](../../Index.md)

# ğŸ³ Docker ì§„í–‰ ê°€ì´ë“œ

---

## 1. Docker ë¡œì»¬ ì—”ì§„ ì„¤ì •

### 1.1. í™˜ê²½ë³€ìˆ˜ ì„¤ì •

- `DOCKER_HOME`: `C:\DEV\CLOUD\Docker\20.10.10`
- `PATH` í™˜ê²½ë³€ìˆ˜ì— `%DOCKER_HOME%\bin` ì¶”ê°€

---

### 1.2. Docker ì—”ì§„ ì„¤ì¹˜ ë°©ë²•

#### 1.2.1. ì„¤ì¹˜ í”„ë¡œê·¸ë¨ìœ¼ë¡œ ì„¤ì¹˜ (Docker Desktop)

- ì‹¤í–‰ íŒŒì¼: `Docker Desktop Installer.exe`

#### 1.2.2. WSL (Windows Subsystem for Linux)ì„ ì´ìš©í•œ ì„¤ì¹˜

1.  **Ubuntu ë°°í¬íŒ ì„¤ì¹˜**
    ```bash
    wsl --install -d Ubuntu
    ```

2.  **Ubuntu ì‹¤í–‰**
    ```bash
    wsl -d Ubuntu -u root
    ```
    > **Tip:** Git Bash ë“±ì—ì„œ í˜¸í™˜ì„± ë¬¸ì œê°€ ë°œìƒí•˜ë©´ `winpty wsl -d Ubuntu -u root` ëª…ë ¹ì„ ì‚¬ìš©í•˜ì„¸ìš”.

3.  **Hyper-V ì„¤ì • í™•ì¸**
    - Windowsì—ì„œ Hyper-Vê°€ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
      ```bash
      bcdedit /enum | findstr /i hypervisorlaunchtype
      ```
    - ë§Œì•½ ê²°ê³¼ê°€ `Auto`ê°€ ì•„ë‹ˆë¼ë©´, ê´€ë¦¬ì ê¶Œí•œìœ¼ë¡œ ë‹¤ìŒ ëª…ë ¹ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.
      ```bash
      bcdedit /set hypervisorlaunchtype auto
      ```
    - **ì£¼ì˜:** VirtualBoxì™€ Dockerë¥¼ ë™ì‹œì— ì‚¬ìš©í•˜ë ¤ë©´ Hyper-Vë¥¼ ë¹„í™œì„±í™”í•´ì•¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (`bcdedit /set hypervisorlaunchtype off`).

4.  **Ubuntu íŒ¨í‚¤ì§€ ì—…ë°ì´íŠ¸ ë° Docker ì„¤ì¹˜**
    ```bash
    apt update
    apt install -y docker.io
    ```

5.  **Docker ë°ëª¬ ì™¸ë¶€ ì ‘ì† ì„¤ì •**
    - `/etc/docker/daemon.json` íŒŒì¼ì„ ì—´ê³  ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •í•©ë‹ˆë‹¤.
      ```json
      {
        "hosts": ["unix:///var/run/docker.sock", "tcp://0.0.0.0:2375"],
        "dns": ["8.8.8.8", "8.8.4.4"]
      }
      ```

6.  **Docker ë°ëª¬ ì‹¤í–‰**
    - `DOCKER_HOST` í™˜ê²½ë³€ìˆ˜ë¥¼ ì„¤ì •í•˜ê±°ë‚˜ `-H` ì˜µì…˜ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
      ```bash
      export DOCKER_HOST=tcp://localhost:2375
      nohup dockerd > /var/log/docker.log 2>&1 &
      ```

7.  **WSL ê´€ë¦¬**
    ```bash
    wsl --list --verbose
    wsl --shutdown
    wsl --unregister <ë°°í¬ëª…> # ì˜ˆ: wsl --unregister Ubuntu
    ```

#### 1.2.3. Portable `dockerd.exe` ì‚¬ìš©

1.  **ì—”ì§„ ì‹œì‘ (ê´€ë¦¬ì ê¶Œí•œ í•„ìˆ˜)**
    ```powershell
    # DOCKER_HOST í™˜ê²½ë³€ìˆ˜ ì„¤ì •
    set DOCKER_HOST=npipe:////./pipe/docker_engine
    # ë°±ê·¸ë¼ìš´ë“œë¡œ ì‹¤í–‰
    nohup dockerd > /C/DEV/CLOUD/Docker/log/docker.log 2>&1 &
    ```

2.  **ì—”ì§„ ì¤‘ì§€**
    ```powershell
    taskkill /PID <PID> /F
    del C:\ProgramData\docker\docker.pid
    ```

---

## 2. Docker í´ë¼ì´ì–¸íŠ¸ ê¸°ë³¸ ëª…ë ¹ì–´

### 2.1. ìœ ìš©í•œ Alias (Linux/WSL)

```bash
# ëª¨ë“  ì»¨í…Œì´ë„ˆ ê°•ì œ ì‚­ì œ
alias crm='docker rm -f $(docker ps -aq)'
# ì»¨í…Œì´ë„ˆ IP ì£¼ì†Œ ì¡°íšŒ
alias cip='docker inspect --format "{{.NetworkSettings.IPAddress}}"'
# ì»¨í…Œì´ë„ˆ ë¡œê·¸ ì‹¤ì‹œê°„ í™•ì¸
alias clog='docker logs -f'
# í…ìŠ¤íŠ¸ íŒŒì¼ í˜•ì‹ ë³€í™˜ (DOS to Unix)
alias cdos='find . -type f \( -name "*.sh" -o -name "*.sql" -o -name "*.yml" \) -exec dos2unix {} \;'
```

### 2.2. ì ‘ì† ë° ì»¨í…Œì´ë„ˆ í™•ì¸

-   **ì›ê²© ì„œë²„ ì ‘ì† (SSH)**
    ```bash
    docker context create myserver --docker "host=ssh://root@<IPì£¼ì†Œ>"
    docker context use myserver
    ```
-   **ë¡œì»¬ ì ‘ì† (WSL)**
    ```bash
    # DOCKER_HOST í™˜ê²½ë³€ìˆ˜ ì„¤ì • í›„
    export DOCKER_HOST=tcp://localhost:2375
    docker ps -a
    ```
-   **ë¡œì»¬ ì ‘ì† (dockerd.exe)**
    ```powershell
    # DOCKER_HOST í™˜ê²½ë³€ìˆ˜ ì„¤ì • í›„
    set DOCKER_HOST=npipe:////./pipe/docker_engine
    docker ps -a
    ```

---

## 3. ì´ë¯¸ì§€ ë° ì»¨í…Œì´ë„ˆ ê´€ë¦¬

### 3.1. ì´ë¯¸ì§€ ê²€ìƒ‰ ë° ë‹¤ìš´ë¡œë“œ

```bash
# 'tomcat' ì´ë¯¸ì§€ ê²€ìƒ‰
docker search tomcat
# 'tomcat:10' íƒœê·¸ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
docker pull tomcat:10
```

### 3.2. ì»¨í…Œì´ë„ˆ ì‹¤í–‰

```bash
docker run -d --name tomcat10 -p 6080:8080 tomcat:10
```

-   `-d`: ë°ëª¬ ëª¨ë“œ (ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰)
-   `--name`: ì»¨í…Œì´ë„ˆ ì´ë¦„ ì§€ì •
-   `-p`: í¬íŠ¸ ë§¤í•‘ (`<í˜¸ìŠ¤íŠ¸ í¬íŠ¸>:<ì»¨í…Œì´ë„ˆ í¬íŠ¸>`)
-   `tomcat:10`: ì‹¤í–‰í•  ì´ë¯¸ì§€

---

## 4. Dockerfile ì‘ì„±

### 4.1. Dockerfile ìƒ˜í”Œ (Spring Boot JAR)

```dockerfile
# 1. ë² ì´ìŠ¤ ì´ë¯¸ì§€ ì„ íƒ (Java 21 JDK)
FROM eclipse-temurin:21-jdk

# 2. ì´ë¯¸ì§€ ì‘ì„±ì ì •ë³´ (ì„ íƒ ì‚¬í•­)
LABEL maintainer="dev@company.com"

# 3. ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ì‘ì—… ë””ë ‰í† ë¦¬ ì„¤ì •
WORKDIR /app

# 4. ë¹Œë“œ ê²°ê³¼ë¬¼(JAR)ì„ ì»¨í…Œì´ë„ˆì— ë³µì‚¬
COPY target/sample-app.jar app.jar

# 5. ì»¨í…Œì´ë„ˆê°€ ì™¸ë¶€ì— ë…¸ì¶œí•  í¬íŠ¸ (ë¬¸ì„œí™” ëª©ì )
EXPOSE 8080

# 6. ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ì‹œ ìˆ˜í–‰í•  ê¸°ë³¸ ëª…ë ¹ì–´
ENTRYPOINT ["java", "-jar", "app.jar"]
```

### 4.2. ë©€í‹° ìŠ¤í…Œì´ì§€ ë¹Œë“œ (ê¶Œì¥)

ë©€í‹° ìŠ¤í…Œì´ì§€ ë¹Œë“œëŠ” ìµœì¢… ì´ë¯¸ì§€ í¬ê¸°ë¥¼ ì¤„ì´ê³  ë³´ì•ˆì„ ê°•í™”í•˜ëŠ” ê°€ì¥ ì¢‹ì€ ë°©ë²•ì…ë‹ˆë‹¤.

```dockerfile
# ---- 1. ë¹Œë“œ ìŠ¤í…Œì´ì§€ ----
# Mavenê³¼ JDKê°€ í¬í•¨ëœ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•˜ì—¬ ì†ŒìŠ¤ ì½”ë“œë¥¼ ë¹Œë“œí•©ë‹ˆë‹¤.
FROM eclipse-temurin:21-jdk AS builder
WORKDIR /build
COPY . .
RUN ./mvnw clean package -DskipTests

# ---- 2. ëŸ°íƒ€ì„ ìŠ¤í…Œì´ì§€ ----
# ì‹¤ì œ ì‹¤í–‰ì— í•„ìš”í•œ JREë§Œ í¬í•¨ëœ ê°€ë²¼ìš´ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
FROM eclipse-temurin:21-jre
WORKDIR /app

# ë¹Œë“œ ìŠ¤í…Œì´ì§€ì—ì„œ ìƒì„±ëœ JAR íŒŒì¼ë§Œ ë³µì‚¬í•©ë‹ˆë‹¤.
COPY --from=builder /build/target/sample-app.jar app.jar

EXPOSE 8080
ENTRYPOINT ["java", "-jar", "app.jar"]
```

**ì¥ì :**
-   ìµœì¢… ì´ë¯¸ì§€ì— ì†ŒìŠ¤ ì½”ë“œ, ë¹Œë“œ ë„êµ¬(Maven), ë¶ˆí•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ í¬í•¨ë˜ì§€ ì•Šì•„ **ì´ë¯¸ì§€ í¬ê¸°ê°€ ëŒ€í­ ê°ì†Œ**í•©ë‹ˆë‹¤.
-   ê³µê²© í‘œë©´ì´ ì¤„ì–´ë“¤ì–´ **ë³´ì•ˆì„±ì´ í–¥ìƒ**ë©ë‹ˆë‹¤.

---

## 5. ì´ë¯¸ì§€ ë¹Œë“œ ë° ì»¨í…Œì´ë„ˆ ì‹¤í–‰

```bash
# í˜„ì¬ ë””ë ‰í† ë¦¬ì˜ Dockerfileì„ ì‚¬ìš©í•˜ì—¬ 'webserver:v1' ì´ë¯¸ì§€ ë¹Œë“œ
docker build -t webserver:v1 .

# 'webserver:v1' ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•˜ì—¬ 'web' ì»¨í…Œì´ë„ˆ ì‹¤í–‰
docker run -d -p 8080:80 --name web webserver:v1
```

---

## 6. ì»¨í…Œì´ë„ˆ ê´€ë¦¬ ëª…ë ¹ì–´

```bash
# ì‹¤í–‰ ì¤‘ì¸ ì»¨í…Œì´ë„ˆ ë° ëª¨ë“  ì»¨í…Œì´ë„ˆ í™•ì¸
docker ps -a

# ì»¨í…Œì´ë„ˆ ë¡œê·¸ í™•ì¸ (-f: ì‹¤ì‹œê°„ ì¶”ì )
docker logs -f <ì»¨í…Œì´ë„ˆëª…>

# ì»¨í…Œì´ë„ˆ ìƒì„¸ ì •ë³´ í™•ì¸
docker inspect <ì»¨í…Œì´ë„ˆëª…>

# ì»¨í…Œì´ë„ˆ IP ì£¼ì†Œë§Œ ì¶”ì¶œ
docker inspect --format '{{.NetworkSettings.IPAddress}}' <ì»¨í…Œì´ë„ˆëª…>

# ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ì‰˜ ì ‘ì†
docker exec -it <ì»¨í…Œì´ë„ˆëª…> /bin/bash

# ì»¨í…Œì´ë„ˆ ì¤‘ì§€, ì‹œì‘, ì‚­ì œ
docker stop <ì»¨í…Œì´ë„ˆëª…>
docker start <ì»¨í…Œì´ë„ˆëª…>
docker rm <ì»¨í…Œì´ë„ˆëª…>

# ì´ë¯¸ì§€ ëª©ë¡ ë° ì‚­ì œ
docker images
docker rmi <ì´ë¯¸ì§€ëª…>

# ë„¤íŠ¸ì›Œí¬ ëª©ë¡ ë° ì‚­ì œ
docker network ls
docker network rm <ë„¤íŠ¸ì›Œí¬ì´ë¦„>
```

---

## 7. Docker Hub ì—°ë™

```bash
# Docker Hub ë¡œê·¸ì¸
docker login -u <ê³„ì •ëª…>

# ì´ë¯¸ì§€ë¥¼ 'ê³„ì •ëª…/ì´ë¯¸ì§€ëª…:íƒœê·¸' í˜•ì‹ìœ¼ë¡œ íƒœê·¸ ì§€ì •
docker tag tomcat:10 <ê³„ì •ëª…>/tomcat:10

# ì´ë¯¸ì§€ í‘¸ì‹œ (ì—…ë¡œë“œ)
docker push <ê³„ì •ëª…>/tomcat:10
```

---

## 8. Docker Compose ì‚¬ìš©ë²•

`docker-compose`ëŠ” ì—¬ëŸ¬ ì»¨í…Œì´ë„ˆë¥¼ ì •ì˜í•˜ê³  ì‹¤í–‰í•˜ê¸° ìœ„í•œ ë„êµ¬ì…ë‹ˆë‹¤.

### 8.1. `docker-compose.yml` ì˜ˆì‹œ (WordPress + MySQL)

```yaml
version: "3.9"

services:
  mysql:
    image: mysql:5.7
    volumes:
      # 'db_data'ë¼ëŠ” ì´ë¦„ì˜ ë³¼ë¥¨ì„ ì»¨í…Œì´ë„ˆì˜ /var/lib/mysql ê²½ë¡œì— ë§ˆìš´íŠ¸
      - db_data:/var/lib/mysql
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: db2admin
      MYSQL_DATABASE: wordpress
      MYSQL_USER: wordpress
      MYSQL_PASSWORD: wordpress

  wordpress:
    depends_on:
      - mysql
    image: wordpress:latest
    volumes:
      - ./wordpress_data:/var/www/html
    ports:
      - "7070:80"
    restart: always
    environment:
      WORDPRESS_DB_HOST: mysql:3306 # ì„œë¹„ìŠ¤ ì´ë¦„ 'mysql'ë¡œ ì ‘ê·¼
      WORDPRESS_DB_NAME: wordpress
      WORDPRESS_DB_USER: wordpress
      WORDPRESS_DB_PASSWORD: wordpress

# Dockerê°€ ê´€ë¦¬í•˜ëŠ” ë°ì´í„° ë³¼ë¥¨ ì •ì˜
volumes:
  db_data: {}
```

### 8.2. Docker Compose ì‹¤í–‰

```bash
# í¬ê·¸ë¼ìš´ë“œ ì‹¤í–‰ (ë¡œê·¸ í™•ì¸ìš©)
docker compose -f wordpress-compose.yml up

# ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰
docker compose -f wordpress-compose.yml up -d

# ì„œë¹„ìŠ¤ ì¤‘ì§€ ë° ì»¨í…Œì´ë„ˆ/ë„¤íŠ¸ì›Œí¬ ì‚­ì œ
docker compose -f wordpress-compose.yml down

# ë³¼ë¥¨ê¹Œì§€ ëª¨ë‘ ì‚­ì œ
docker compose -f wordpress-compose.yml down -v
```

---

## 9. Dstone í”„ë ˆì„ì›Œí¬ ì ìš©

### 9.1. ì‹¤í–‰ íŒŒì¼ ì¤€ë¹„

-   `/dstone-boot/target`ì— `war` íŒŒì¼ ìƒì„± (Maven ë¹Œë“œ)
-   `/dstone-batch/target`ì— `jar` íŒŒì¼ ìƒì„± (Maven ë¹Œë“œ)
-   `/dstone-batch-server/target`ì— `jar` íŒŒì¼ ìƒì„± (`bin/00.deploy.bat` ì‹¤í–‰)

### 9.2. Docker Host ì‘ì—… êµ¬ì¡°

`dstone` í”„ë ˆì„ì›Œí¬ëŠ” ì•„ë˜ì™€ ê°™ì€ `workshop` ë””ë ‰í† ë¦¬ êµ¬ì¡°ë¥¼ ì‚¬ìš©í•˜ì—¬ Docker í™˜ê²½ì„ êµ¬ì„±í•©ë‹ˆë‹¤.

```text
/workshop
  â””â”€ /dstone-boot                              # <Boot Application>
     â”œâ”€ conf/                                  #   ì„¤ì • íŒŒì¼
     â”œâ”€ target/                                #   ì‹¤í–‰ íŒŒì¼
     â”œâ”€ 01.dstone-boot-docker.yml              #   ê°œë³„ Docker Compose ë¹Œë“œíŒŒì¼
     â””â”€ 02.dstone-boot-docker-reg.sh           #   Docker Hub ë“±ë¡ Shell
  â””â”€ /dstone-mysql                             # <Database (MySQL)>
     â”œâ”€ init-db/                               #   DB ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸
     â”œâ”€ 01.dstone-mysql-docker.yml             #   ê°œë³„ Docker Compose ë¹Œë“œíŒŒì¼
     â””â”€ 02.dstone-mysql-docker-reg.sh          #   Docker Hub ë“±ë¡ Shell
  â””â”€ /dstone-rabbitmq                          # <RabbitMQ>
     â”œâ”€ init-data/                             #   ì´ˆê¸° ë°ì´í„°
     â”œâ”€ 01.dstone-rabbitmq-docker.yml          #   ê°œë³„ Docker Compose ë¹Œë“œíŒŒì¼
     â””â”€ 02.dstone-rabbitmq-docker-reg.sh       #   Docker Hub ë“±ë¡ Shell
  â””â”€ /workshop/dstone-redis                    # <Redis>
     â”œâ”€ 01.dstone-redis-docker.yml             #   ê°œë³„ Docker Compose ë¹Œë“œíŒŒì¼
     â””â”€ 02.dstone-redis-docker-reg.sh          #   Docker Hub ë“±ë¡ Shell
  â””â”€ /dstone-batch                             # <Batch Application>
     â”œâ”€ conf/                                  #   ì„¤ì • íŒŒì¼
     â”œâ”€ target/                                #   ì‹¤í–‰ íŒŒì¼
     â”œâ”€ 01.dstone-batch-docker.yml             #   ê°œë³„ Docker Compose ë¹Œë“œíŒŒì¼
     â””â”€ 02.dstone-batch-docker-reg.sh          #   Docker Hub ë“±ë¡ Shell
  â””â”€ /dstone-batch-server                      # <Batch Admin Application>
     â”œâ”€ conf/                                  #   ì„¤ì • íŒŒì¼
     â”œâ”€ target/                                #   ì‹¤í–‰ íŒŒì¼
     â”œâ”€ 01.dstone-batch-server-docker.yml      #   ê°œë³„ Docker Compose ë¹Œë“œíŒŒì¼
     â””â”€ 02.dstone-batch-server-docker-reg.sh   #   Docker Hub ë“±ë¡ Shell
  â””â”€ /workshop/dstone-boot-docker-compose.yml  # dstone-boot Docker Compose ë¹Œë“œíŒŒì¼
  â””â”€ /workshop/dstone-batch-docker-compose.yml # dstone-batch Docker Compose ë¹Œë“œíŒŒì¼
  â””â”€ /workshop/dstone-docker-compose.yml       # ì „ì²´ Docker Compose ë¹Œë“œíŒŒì¼
```

### 9.3. ê¶Œí•œ ì„¤ì • ë° íŒŒì¼ í˜•ì‹ ë³€í™˜

-   ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ ê¶Œí•œ ë¬¸ì œë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ í˜¸ìŠ¤íŠ¸ì˜ íŒŒì¼ ê¶Œí•œì„ ì¡°ì •í•©ë‹ˆë‹¤.
    ```bash
    chown -R root:root *
    chmod -R 777 *
    ```
-   Windowsì—ì„œ ì‘ì„±ëœ ì‰˜ ìŠ¤í¬ë¦½íŠ¸(`.sh`)ë‚˜ ì„¤ì • íŒŒì¼(`.yml`)ì˜ ê°œí–‰ ë¬¸ìë¥¼ Unix í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
    ```bash
    # cdos ì•Œë¦¬ì•„ìŠ¤ ë˜ëŠ” dos2unix ì§ì ‘ ì‚¬ìš©
    alias cdos='find . -type f \( -name "*.sh" -o -name "*.sql" -o -name "*.yml" \) -exec dos2unix {} \;'
    ```

### 9.4. Dstone í”„ë ˆì„ì›Œí¬ ì‹¤í–‰

-   ì „ì²´ ì„œë¹„ìŠ¤ë¥¼ í•œ ë²ˆì— ì‹¤í–‰, ëª¨ë‹ˆí„°ë§, ì¤‘ì§€í•©ë‹ˆë‹¤.
    ```bash
    # ì‹¤í–‰ (-p: í”„ë¡œì íŠ¸ ì´ë¦„ ì§€ì •)
    docker compose -p dstone -f /workshop/dstone-docker-compose.yml up -d

    # ë¡œê·¸ í™•ì¸
    docker compose -p dstone -f /workshop/dstone-docker-compose.yml logs -f

    # ì¤‘ì§€ ë° ëª¨ë“  ë¦¬ì†ŒìŠ¤(ë³¼ë¥¨ í¬í•¨) ì‚­ì œ
    docker compose -p dstone -f /workshop/dstone-docker-compose.yml down -v
    ```

### 9.5. ê°œë³„ ì»¨í…Œì´ë„ˆ ì œì–´

```bash
docker stop dstone-boot
docker start dstone-boot
```
