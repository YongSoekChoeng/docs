# ğŸ³ Docker ì§„í–‰ ê°€ì´ë“œ 

---

## 1. Docker ë¡œì»¬ ì—”ì§„ ì„¤ì •

### 1.1 í™˜ê²½ë³€ìˆ˜ ì„¤ì •
- `DOCKER_HOME` : `C:\DEV\CLOUD\Docker\20.10.10`
- `DOCKER_HOME` ì„ `PATH` ë³€ìˆ˜ì— ì¶”ê°€

---

### 1.2 Docker ì—”ì§„ ì„¤ì¹˜ ë°©ë²•

#### (1) ì„¤ì¹˜ í”„ë¡œê·¸ë¨ìœ¼ë¡œ ì„¤ì¹˜
- ì‹¤í–‰ íŒŒì¼: `Docker Desktop Installer.exe`

#### (2) WSLì„ ì´ìš©í•œ ì„¤ì¹˜
1. **Ubuntu ì„¤ì¹˜**
   ```bash
   wsl --install -d Ubuntu
   ```

2. **Ubuntu ì‹¤í–‰ (í˜¸í™˜ì„± ë¬¸ì œ ë°œìƒ ì‹œ `winpty` ì‚¬ìš©)**
   ```bash
   wsl -d Ubuntu -u root
   winpty wsl -d Ubuntu -u root
   ```

   - í˜¸ìŠ¤íŠ¸ PCì˜ `hypervisorlaunchtype` ì„¤ì • í™•ì¸:
     ```bash
     bcdedit /enum | findstr /i hypervisorlaunchtype
     ```
     - ê²°ê³¼ê°€ `Auto` ê°€ ì•„ë‹ˆë¼ë©´ ìˆ˜ì •:
       ```bash
       bcdedit /set hypervisorlaunchtype auto
       ```
   - VirtualBoxë¥¼ ì‚¬ìš©í•œë‹¤ë©´ `off` ë¡œ ì„¤ì •í•´ì•¼ í•¨:
     ```bash
     bcdedit /set hypervisorlaunchtype off
     ```

3. **Ubuntu ì—…ë°ì´íŠ¸ ë° Docker ì„¤ì¹˜**
   ```bash
   apt update
   apt install -y docker.io
   ```

4. **Docker ë°ëª¬ ì™¸ë¶€ì ‘ì† ì„¤ì •**
   ```bash
   vi /etc/docker/daemon.json
   ```
   ```json
   {
     "hosts": ["unix:///var/run/docker.sock", "tcp://0.0.0.0:2375"],
	 "dns": ["8.8.8.8", "8.8.4.4"]
   }
   ```

5. **Docker ë°ëª¬ ì‹¤í–‰**
   ```bash
   nohup dockerd -H tcp://localhost:2375 > /var/log/docker.log 2>&1 &
   ```
   ë˜ëŠ” `DOCKER_HOST` í™˜ê²½ë³€ìˆ˜ ì„¤ì • í›„:
   ```bash
   export DOCKER_HOST=tcp://localhost:2375
   nohup dockerd > /var/log/docker.log 2>&1 &
   ```

6. **Docker ë°ëª¬ ì¤‘ì§€**
   ```bash
   kill -9 <PID>
   ```

7. **WSL ê´€ë¦¬**
   ```bash
   wsl --list --verbose
   wsl --shutdown
   wsl --unregister <ë°°í¬ëª…>
   ```

---

#### (3) Portable `dockerd.exe` ì‚¬ìš©
1. **ì—”ì§„ ì‹œì‘ (ê´€ë¦¬ì ê¶Œí•œ í•„ìˆ˜)**
   ```bash
   nohup dockerd -H npipe:////./pipe/docker_engine > /C/DEV/CLOUD/Docker/log/docker.log 2>&1 &
   ```
   ë˜ëŠ” í™˜ê²½ë³€ìˆ˜ë¡œ ì§€ì •:
   ```bash
   set DOCKER_HOST=npipe:////./pipe/docker_engine
   nohup dockerd > /C/DEV/CLOUD/Docker/log/docker.log 2>&1 &
   ```

2. **ì—”ì§„ ì¤‘ì§€**
   ```bash
   taskkill /PID <PID> /F
   del C:\ProgramData\docker\docker.pid
   ```
   
---

## 2. Docker í´ë¼ì´ì–¸íŠ¸ ê¸°ë³¸ ëª…ë ¹ì–´

### 2.1 ìœ ìš©í•œ Alias
```bash
alias crm='docker rm -f $(docker ps -aq)'
alias cip='docker inspect --format "{{.NetworkSettings.IPAddress}}"'
alias clog='docker logs -f'
```

### 2.2 ì ‘ì† ë° ì»¨í…Œì´ë„ˆ í™•ì¸

#### ì›ê²© ì ‘ì†
```bash
docker context create myserver --docker "host=ssh://root@<IPì£¼ì†Œ>"
docker context use myserver
```

#### ë¡œì»¬ ì ‘ì† (WSL)
```bash
docker -H tcp://localhost:2375 ps -a
# ë˜ëŠ”
export DOCKER_HOST=tcp://localhost:2375
docker ps -a
```

#### ë¡œì»¬ ì ‘ì† (dockerd.exe)
```bash
docker -H npipe:////./pipe/docker_engine ps -a
# ë˜ëŠ”
set DOCKER_HOST=npipe:////./pipe/docker_engine
docker ps -a
```

---

## 3. ì´ë¯¸ì§€ ë° ì»¨í…Œì´ë„ˆ ê´€ë¦¬

### 3.1 ì´ë¯¸ì§€ ê²€ìƒ‰ ë° ë‹¤ìš´ë¡œë“œ
```bash
docker search tomcat
docker pull tomcat:10
docker pull tomcat:latest
```

### 3.2 ì»¨í…Œì´ë„ˆ ì‹¤í–‰
```bash
docker run -d --name tomcat10 -p 6080:8080 tomcat:10
docker run -d --name tomcat10 -p 6080:8080 -p 2222:22 tomcat:10
```

ì˜µì…˜ ì„¤ëª…:
- `-d`: ë°ëª¬ ëª¨ë“œ
- `--name`: ì»¨í…Œì´ë„ˆ ì´ë¦„
- `-p`: í¬íŠ¸ ë§¤í•‘
- ë§ˆì§€ë§‰ ì¸ì: ì´ë¯¸ì§€ ID ë˜ëŠ” ì´ë¦„

---

## 4. Dockerfile ì˜ˆì œ

### (1) Webserver (Ubuntu + Apache)
```dockerfile
FROM ubuntu:18.04
LABEL maintainer="JYS"
RUN apt-get update && apt-get install -y apache2
RUN echo "Test Web" > /var/www/html/index.html
EXPOSE 80
CMD ["/usr/sbin/apache2ctl", "-DFOREGROUND"]
```

### (2) HelloJS (Node.js)
```dockerfile
FROM node:24
COPY docker-entrypoint.sh /usr/local/bin/
RUN chmod +x /usr/local/bin/docker-entrypoint.sh
ENTRYPOINT ["/usr/local/bin/docker-entrypoint.sh"]
COPY hello.js /
CMD ["node", "/hello.js"]
```

---

## 5. ì´ë¯¸ì§€ ë¹Œë“œ ë° ì»¨í…Œì´ë„ˆ ì‹¤í–‰

```bash
docker build -t webserver:v1 .
docker build -t hellojs:latest .
docker run -d -p 8080:80 --name web webserver:v1
docker run -d -p 80:80 --name hellojs hellojs:latest
```

---

## 6. ì»¨í…Œì´ë„ˆ ê´€ë¦¬ ëª…ë ¹ì–´

| ì‘ì—… | ëª…ë ¹ì–´ |
|------|--------|
| ìƒíƒœí™•ì¸ | `docker ps -a` |
| ë¡œê·¸ í™•ì¸ | `docker logs -f <ì»¨í…Œì´ë„ˆëª…>` |
| ìƒì„¸ ì •ë³´ | `docker inspect <ì»¨í…Œì´ë„ˆëª…>` |
| IP í™•ì¸ | `docker inspect --format '{{.NetworkSettings.IPAddress}}' <ì»¨í…Œì´ë„ˆëª…>` |
| ì ‘ì† | `docker exec -it <ì»¨í…Œì´ë„ˆëª…> /bin/bash` |
| ì¤‘ì§€ | `docker stop <ì»¨í…Œì´ë„ˆëª…>` |
| ì¬ì‹œì‘ | `docker start <ì»¨í…Œì´ë„ˆëª…>` |
| ì‚­ì œ | `docker rm <ì»¨í…Œì´ë„ˆëª…>` |
| ì´ë¯¸ì§€ ëª©ë¡ | `docker images` |
| ì´ë¯¸ì§€ ì‚­ì œ | `docker rmi <ì´ë¯¸ì§€ëª…>` |

---

## 7. Docker Hub ì—°ë™

```bash
docker login -u <ê³„ì •ëª…>
docker tag tomcat:10 <ê³„ì •ëª…>/tomcat:10
docker push <ê³„ì •ëª…>/tomcat:10
docker pull <ê³„ì •ëª…>/tomcat:10
```

---

## 8. ì»¨í…Œì´ë„ˆ ë¦¬ì†ŒìŠ¤ ê´€ë¦¬

- **ë©”ëª¨ë¦¬ ì œí•œ**
  ```bash
  docker run -d --name hellojs -p 80:80 -m 512m hellojs:latest
  docker run -d --name hellojs -p 80:80 -m 512m --memory-reservation 256m hellojs:latest
  docker run -d --name hellojs -p 80:80 -m 512m --memory-swap 1024m hellojs:latest
  ```

- **CPU ì œí•œ**
  ```bash
  docker run -d --name hellojs -p 80:80 --cpus=".5" hellojs:latest
  docker run -d --name hellojs -p 80:80 --cpuset-cpus 0-3 hellojs:latest
  docker run -d --name hellojs -p 80:80 --cpu-shares 2048 hellojs:latest
  ```

- **ëª¨ë‹ˆí„°ë§**
  ```bash
  docker stats -a
  docker events -f container=hellojs
  ```
  ğŸ“¦ [Google cAdvisor](https://github.com/google/cadvisor)

---

## 9. ì»¨í…Œì´ë„ˆ Storage

- **ë°ì´í„° ì˜êµ¬ ì €ì¥**
  ```bash
  docker run -d --name mysql -p 33060:3306 -v /mysql_data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=db2admin mysql:latest
  ```

- **ì»¨í…Œì´ë„ˆê°„ ë°ì´í„° ê³µìœ **
  ```bash
  docker run -d -p 8080:80 --name web1 -v /web_data:/usr/share/nginx/html:rw webserver:v1
  docker run -d -p 8081:80 --name web2 -v /web_data:/usr/share/nginx/html:ro webserver:v1
  ```

- **ë³¼ë¥¨ ê´€ë¦¬**
  ```bash
  docker volume create mysql_data
  docker volume ls
  docker volume rm mysql_data
  ```
- **ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ë¡œ ì €ì¥**
  ```bash
  docker commit dstone-batch dstone-batch:latest
  docker tag dstone-batch:latest jysn007/dstone-batch:1.0.0
  docker login -u jysn007 -p 'db2admin!@'
  docker push jysn007/dstone-batch:1.0.0
  ```

---

## 10. ë„¤íŠ¸ì›Œí¬ ì„¤ì •

```bash
docker network create --driver bridge --subnet 192.168.100.0/24 --gateway 192.168.100.254 mynet
docker network ls
docker run -d --name appjs --net mynet --ip 192.168.100.100 -p 8080:8080 appjs:latest
```

### WordPress + MySQL ì˜ˆì œ
```bash
docker run -d --name mysql5.7 -p 33060:3306 -v /mysql_data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=db2admin mysql:5.7
docker run -d --name wordpress -p 7070:80 --link mysql5.7:mysql -e WORDPRESS_DB_PASSWORD=db2admin wordpress:4
```

---

## 11. Docker Compose ì˜ˆì œ

**ì„¤ì¹˜**
```bash
curl -SL https://github.com/docker/compose/releases/download/v2.40.0/docker-compose-linux-x86_64 -o /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose
```

**YAML ì˜ˆì‹œ (wordpress-compose.yml)**

```yaml
version: "3.9"
services:
  mysql5.7:
  
    # ---------- ìµœì´ˆì‘ì—…ì¼ ë•Œ ------------------------- #
    image: mysql:5.7
    # --------------------------------------------- #    
    # ---------- Docker Hub ì—ì„œ ê°€ì ¸ì˜¬ ë•Œ ------------- #
    # image: jysn007/mysql:5.7
    # --------------------------------------------- #
	
	###########################################################
	# <ì„œë¹„ìŠ¤ ë‚´ë¶€ Volumes (ë°”ì¸ë“œ ë§ˆìš´íŠ¸ vs ë³¼ë¥¨ ì°¸ì¡°)>
	# A.íƒ€ì… 1: ë°”ì¸ë“œ ë§ˆìš´íŠ¸ (Bind Mount)
	#   - í˜¸ìŠ¤íŠ¸ì˜ ì‹¤ì œ ê²½ë¡œë¥¼ ì»¨í…Œì´ë„ˆì— ì—°ê²°
	#   - ê²½ë¡œê°€ .ë¡œ ì‹œì‘í•˜ê±°ë‚˜ /ë¡œ ì‹œì‘ (ì ˆëŒ€ê²½ë¡œ)
	#   - íŒŒì¼ì´ë‚˜ ë””ë ‰í† ë¦¬ë¥¼ ì§ì ‘ ê³µìœ 
	#   - ìš©ë„: ì½”ë“œ, ì„¤ì • íŒŒì¼ ë“± ìì£¼ ìˆ˜ì •í•˜ëŠ” ê²ƒë“¤
	#   ì˜ˆ) - ./backend:/app
	# B.íƒ€ì… 2: ë„¤ì„ë“œ ë³¼ë¥¨ ì°¸ì¡° (Named Volume)
	#   - Dockerê°€ ê´€ë¦¬í•˜ëŠ” ë³¼ë¥¨ì„ ì»¨í…Œì´ë„ˆì— ì—°ê²°
	#   - ì´ë¦„ë§Œ ì ìŒ (ê²½ë¡œ ì—†ìŒ)
	#   - ì‹¤ì œ ì €ì¥ ìœ„ì¹˜ëŠ” Dockerê°€ ê´€ë¦¬ (ë³´í†µ /var/lib/docker/volumes/)
	#   - ìµœí•˜ë‹¨ Volumes ì„ ì–¸(ë³¼ë¥¨ ì •ì˜)ì´ ë˜ì–´ìˆì–´ì•¼ í•¨.
	#   - ìš©ë„: ë°ì´í„°ë² ì´ìŠ¤ ë°ì´í„°ì²˜ëŸ¼ ì˜êµ¬ ë³´ì¡´ì´ í•„ìš”í•˜ì§€ë§Œ ì§ì ‘ ìˆ˜ì •í•  ì¼ì€ ì—†ëŠ” ê²ƒë“¤
	#   ì˜ˆ) - db-data:/var/lib/postgresql/data
	###########################################################
    volumes:
      - /mysql_data:/var/lib/mysql
    ports:
      - "33060:3306"
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: db2admin
      MYSQL_DATABASE: wordpress
      MYSQL_USER: wordpress
      MYSQL_PASSWORD: wordpress

  wordpress:
    depends_on:
      - mysql5.7
    image: wordpress:4
    volumes:
      - /wordpress_data:/var/www/html
    ports:
      - "7070:80"
    restart: always
    environment:
      WORDPRESS_DB_HOST: mysql5.7:3306
      WORDPRESS_DB_NAME: wordpress
      WORDPRESS_DB_USER: wordpress
      WORDPRESS_DB_PASSWORD: wordpress
	  
######################################
# Volumes ì„ ì–¸(ë³¼ë¥¨ ì •ì˜)
# - ë„¤ì„ë“œ ë³¼ë¥¨ ì°¸ì¡° (Named Volume)ì—ì„œ ì‚¬ìš©.
######################################
volumes:
  mysql_data: {}
  wordpress_data: {}
```

**ì‹¤í–‰**
```bash
docker-compose -f ./wordpress-compose.yml up -d
```

---

## 12. ì»¨í…Œì´ë„ˆ SSH ì ‘ì† ì„¤ì •

```bash
winpty docker exec -it tomcat10 bash
apt-get update
apt-get install -y net-tools vim openssh-server
passwd root
vim /etc/ssh/sshd_config   # PermitRootLogin yes ë¡œ ìˆ˜ì •
service ssh start
systemctl enable ssh.service
```

---

ğŸ“˜ **ì •ë¦¬ ì™„ë£Œ (2025 ë²„ì „)**  
ì´ ë¬¸ì„œëŠ” Windows, WSL, ë˜ëŠ” Portable Docker í™˜ê²½ ëª¨ë‘ì—ì„œ ì‹¤í–‰ ê°€ëŠ¥í•œ í‘œì¤€í™”ëœ Docker ìš´ì˜ ë§¤ë‰´ì–¼ì…ë‹ˆë‹¤.
