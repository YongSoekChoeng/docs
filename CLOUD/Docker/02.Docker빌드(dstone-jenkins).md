[Dstone Document Index](../../Index.md)

# ğŸ³ Dstone Jenkins (CI/CD) Docker ë¹Œë“œ ë° ì‹¤í–‰ ê°€ì´ë“œ

---

## 1. ì»¨í…Œì´ë„ˆ êµ¬ì„± ê°œìš”

ì´ ê°€ì´ë“œëŠ” Docker Composeë¥¼ ì‚¬ìš©í•˜ì—¬ CI/CD í™˜ê²½ì„ ìœ„í•œ **`dstone-jenkins` ì»¨í…Œì´ë„ˆ**ë¥¼ êµ¬ì„±í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…í•©ë‹ˆë‹¤.

-   **dstone-jenkins**: Maven, Docker, Docker Composeê°€ ë‚´ì¥ëœ Jenkins ì„œë²„ë¡œ, `dstone-boot`ì™€ `dstone-batch` í”„ë¡œì íŠ¸ì˜ ì§€ì†ì ì¸ í†µí•© ë° ë°°í¬(CI/CD)ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.

---

## 2. í˜¸ìŠ¤íŠ¸ ë””ë ‰í† ë¦¬ êµ¬ì¡° ë° ì‚¬ì „ ì‘ì—…

1.  **ì‘ì—… ë””ë ‰í† ë¦¬ ìƒì„±**
    -   í˜¸ìŠ¤íŠ¸ ë¨¸ì‹ ì— `/workshop` ë””ë ‰í† ë¦¬ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

2.  **í…œí”Œë¦¿ íŒŒì¼ ë³µì‚¬**
    -   `dstone-jenkins` ê´€ë ¨ ì„¤ì • íŒŒì¼ì„ ì•„ë˜ êµ¬ì¡°ì— ë§ê²Œ `/workshop` ë””ë ‰í† ë¦¬ë¡œ ë³µì‚¬í•©ë‹ˆë‹¤.

    ```text
    /workshop
      â””â”€ dstone-jenkins/
         â”œâ”€ jenkins_home/                          # Jenkins ë°ì´í„°ê°€ ì €ì¥ë˜ëŠ” ë³¼ë¥¨
         â”œâ”€ 01.dstone-jenkins-docker.yml           # Docker Compose íŒŒì¼
         â””â”€ 02.dstone-jenkins-docker-reg.sh        # Docker Hub ë“±ë¡ìš© ì‰˜ ìŠ¤í¬ë¦½íŠ¸
    ```

3.  **íŒŒì¼ ê¶Œí•œ ì„¤ì • (Linux/WSL)**
    -   ì»¨í…Œì´ë„ˆê°€ í˜¸ìŠ¤íŠ¸ì˜ íŒŒì¼ ì‹œìŠ¤í…œì— ì •ìƒì ìœ¼ë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ê¶Œí•œì„ ì„¤ì •í•©ë‹ˆë‹¤.
    ```bash
    cd /workshop
    sudo chown -R root:root *
    sudo chmod -R 777 *
	cdos
    ```

4.  **íŒŒì¼ í˜•ì‹ ë³€í™˜ (Windows ì‚¬ìš©ì)**
    -   Windowsì—ì„œ ì‘ì„±ëœ ì‰˜ ìŠ¤í¬ë¦½íŠ¸ê°€ Linux í™˜ê²½ì—ì„œ ì˜¬ë°”ë¥´ê²Œ ì‹¤í–‰ë˜ë„ë¡ ê°œí–‰ ë¬¸ìë¥¼ ë³€í™˜í•©ë‹ˆë‹¤.
    ```bash
    # cdos ì•Œë¦¬ì•„ìŠ¤ ë˜ëŠ” dos2unix ì§ì ‘ ì‚¬ìš©
	alias cdos='find . -type f \( -name "*.sh" -o -name "*.sql" -o -name "*.yml" \) -exec dos2unix {} \;'
    ```

---

## 3. Docker Composeë¥¼ ì´ìš©í•œ Jenkins ì‹¤í–‰

### 3.1. ì‹¤í–‰ ë° ë¡œê·¸ í™•ì¸

-   **Jenkins ì»¨í…Œì´ë„ˆ ì‹¤í–‰**
    ```bash
    # -p dstone: 'dstone'ì„ í”„ë¡œì íŠ¸ ì´ë¦„ìœ¼ë¡œ ì§€ì •í•˜ì—¬ ê´€ë ¨ ë¦¬ì†ŒìŠ¤(ë„¤íŠ¸ì›Œí¬ ë“±)ë¥¼ ê·¸ë£¹í™”í•©ë‹ˆë‹¤.
    docker compose -p dstone -f /workshop/dstone-jenkins/01.dstone-jenkins-docker.yml up -d
    ```

-   **ì‹¤ì‹œê°„ ë¡œê·¸ í™•ì¸**
    ```bash
    docker compose -p dstone -f /workshop/dstone-jenkins/01.dstone-jenkins-docker.yml logs -f
    ```

### 3.2. ì¤‘ì§€ ë° ì‚­ì œ

-   **ì»¨í…Œì´ë„ˆ ì¤‘ì§€ ë° ì‚­ì œ**
    ```bash
    docker compose -p dstone -f /workshop/dstone-jenkins/01.dstone-jenkins-docker.yml down
    ```

-   **ì»¨í…Œì´ë„ˆ ë° ë°ì´í„° ë³¼ë¥¨ ëª¨ë‘ ì‚­ì œ**
    > âš ï¸ **ì£¼ì˜:** ì´ ëª…ë ¹ì€ `jenkins_home`ì˜ ëª¨ë“  ë°ì´í„°ë¥¼ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œí•©ë‹ˆë‹¤. Jenkins ì„¤ì •ì„ ì´ˆê¸°í™”í•˜ê³  ì‹¶ì„ ë•Œë§Œ ì‚¬ìš©í•˜ì„¸ìš”.
    ```bash
    docker compose -p dstone -f /workshop/dstone-jenkins/01.dstone-jenkins-docker.yml down -v
    ```

### 3.3. ê°œë³„ ì»¨í…Œì´ë„ˆ ì œì–´

```bash
docker stop dstone-jenkins
docker start dstone-jenkins
```

---

## 4. Jenkins ì´ˆê¸° ì„¤ì • (ìµœì´ˆ 1íšŒ)

### 4.1. Jenkins ëŒ€ì‹œë³´ë“œ ì ‘ì†

-   ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ `http://localhost:5555/jenkins` ì£¼ì†Œë¡œ ì ‘ì†í•©ë‹ˆë‹¤.

### 4.2. í•„ìˆ˜ ë„êµ¬ ì„¤ì¹˜ í™•ì¸ (í•„ìš” ì‹œ)

-   Jenkins ì»¨í…Œì´ë„ˆì— ì ‘ì†í•˜ì—¬ ë¹Œë“œì— í•„ìš”í•œ ë„êµ¬ê°€ ì„¤ì¹˜ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

    ```bash
    docker exec -it dstone-jenkins bash
    ```

-   **Maven í™•ì¸**
    ```bash
    mvn -version
    # ì„¤ì¹˜ê°€ í•„ìš”í•˜ë©´: apt update && apt install -y maven
    ```

-   **Docker Compose í™•ì¸**
    ```bash
    docker-compose version
    # ì„¤ì¹˜ê°€ í•„ìš”í•˜ë©´:
    # DOCKER_COMPOSE_VERSION=$(curl -s https://api.github.com/repos/docker/compose/releases/latest | grep 'tag_name' | cut -d'"' -f4)
    # curl -L "https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
    # chmod +x /usr/local/bin/docker-compose
    ```

### 4.3. Jenkins í”ŒëŸ¬ê·¸ì¸ ë° ì„¤ì •

1.  **í•„ìˆ˜ í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜** (`Manage Jenkins > Plugins`)
    -   `Git`
    -   `GitHub`
    -   `Pipeline`
    -   `Docker Pipeline`

2.  **ìê²© ì¦ëª… (Credentials) ë“±ë¡** (`Manage Jenkins > Credentials`)
    -   **`github-credential`**: GitHub ê³„ì • ì •ë³´ (ID/ë¹„ë°€ë²ˆí˜¸ ë˜ëŠ” Token)
    -   **`dockerhub-credential`**: Docker Hub ê³„ì • ì •ë³´ (ID/ë¹„ë°€ë²ˆí˜¸)

---

## 5. Jenkins íŒŒì´í”„ë¼ì¸ í”„ë¡œì íŠ¸ êµ¬ì„±

`dstone-boot`ì™€ `dstone-batch` í”„ë¡œì íŠ¸ë¥¼ ìœ„í•œ íŒŒì´í”„ë¼ì¸ì„ ê°ê° ìƒì„±í•©ë‹ˆë‹¤.

### 5.1. `dstone-boot` íŒŒì´í”„ë¼ì¸ ìƒì„±

1.  **New Item** -> `dstone-boot` ì…ë ¥ -> **Pipeline** ì„ íƒ -> **OK**
2.  **General** íƒ­
    -   `ì˜¤ë˜ëœ ë¹Œë“œ ì‚­ì œ`: í™œì„±í™” (ì˜ˆ: 14ì¼, 50ê°œ)
    -   `Do not allow concurrent builds`: í™œì„±í™”
3.  **Build Triggers** íƒ­
    -   `Build periodically`: `H H(8-15)/2 * * 1-5` (í‰ì¼ 8-15ì‹œ ì‚¬ì´ 2ì‹œê°„ ê°„ê²©ìœ¼ë¡œ ë¹Œë“œ)
4.  **Pipeline** íƒ­
    -   **Definition**: `Pipeline script from SCM`
    -   **SCM**: `Git`
    -   **Repository URL**: `https://github.com/YongSoekChoeng/dstone-boot.git`
    -   **Credentials**: ìœ„ì—ì„œ ë“±ë¡í•œ `github-credential` ì„ íƒ
    -   **Branch Specifier**: `*/master`
    -   **Script Path**: `Jenkinsfile`

### 5.2. `dstone-batch` íŒŒì´í”„ë¼ì¸ ìƒì„±

1.  **New Item** -> `dstone-batch` ì…ë ¥ -> **Pipeline** ì„ íƒ -> **OK**
2.  `dstone-boot`ì™€ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
3.  **Pipeline** íƒ­ ì„¤ì •ë§Œ ì•„ë˜ì™€ ê°™ì´ ë³€ê²½í•©ë‹ˆë‹¤.
    -   **Repository URL**: `https://github.com/YongSoekChoeng/dstone-batch.git`
    -   **Branch Specifier**: `*/main`
    -   **Script Path**: `Jenkinsfile`
