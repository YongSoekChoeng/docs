# â˜¸ï¸ Kubernetes ì§„í–‰ ê°€ì´ë“œ (2025 ë²„ì „)

---

## 1. Kubernetes í™˜ê²½ êµ¬ì„±

### 1.1 VirtualBox ì„¤ì¹˜
- ë‹¤ìš´ë¡œë“œ: [https://www.virtualbox.org/wiki/Downloads]

### 1.2 VM ì„¤ì¹˜
- Ubuntu 20.04ì— Kubernetes ì„¤ì¹˜ ì°¸ê³   
  - [Ubuntu 20.04 ì„¤ì¹˜ ê°€ì´ë“œ](https://www.youtube.com/watch?v=CKUv3oEI8Yo&t=363s)
- Master, Node1, Node2ì— Docker ì„¤ì¹˜ ì°¸ê³   
  - [Docker ì„¤ì¹˜ ê°€ì´ë“œ](https://www.youtube.com/watch?v=V5-h3yvCOSA&t=518s)
- Kubernetes v1.18 ì„¤ì¹˜ ì°¸ê³   
  - [Kubernetes ì„¤ì¹˜ ê°€ì´ë“œ](https://www.youtube.com/watch?v=5Y847xaXe7U)

### 1.3 VM ë„¤íŠ¸ì›Œí¬ êµ¬ì„±

| ì´ë¦„ | í˜¸ìŠ¤íŠ¸ IP | í˜¸ìŠ¤íŠ¸ í¬íŠ¸ | ê²ŒìŠ¤íŠ¸ IP | ê²ŒìŠ¤íŠ¸ í¬íŠ¸ |
|------|------------|--------------|------------|--------------|
| k8s-master | 127.0.0.1 | 100 | 10.100.0.100 | 22 |
| k8s-node1  | 127.0.0.1 | 101 | 10.100.0.101 | 22 |
| k8s-node2  | 127.0.0.1 | 102 | 10.100.0.102 | 22 |

#### `/etc/hostname`
```
master.example.com  â†’ master ë¨¸ì‹ 
node1.example.com   â†’ node1 ë¨¸ì‹ 
node2.example.com   â†’ node2 ë¨¸ì‹ 
```

#### `/etc/hosts`
```
10.100.0.100  master.example.com  master
10.100.0.101  node1.example.com   node1
10.100.0.102  node2.example.com   node2
```

#### VirtualBox ì„¤ì •
- ë„¤íŠ¸ì›Œí¬ ì–´ëŒ‘í„° ëª¨ë“œ: `NAT ë„¤íŠ¸ì›Œí¬`
- ë„¤íŠ¸ì›Œí¬ ì´ë¦„: `k8s-Network (10.100.0.0/16)`

#### VM IP ì„¤ì •
- IPv4 ë°©ì‹: ìˆ˜ë™
- ê²Œì´íŠ¸ì›¨ì´: `10.100.0.1`
- ë„¤ì„ì„œë²„: `8.8.8.8`

#### Hyper-V ì„¤ì •
- **VirtualBox ì‚¬ìš© ì‹œ**:
  ```bash
  bcdedit /set hypervisorlaunchtype off
  ```
- **WSL ì‚¬ìš© ì‹œ**:
  ```bash
  bcdedit /set hypervisorlaunchtype auto
  ```

---

## 2. ê¸°ë³¸ í”„ë¡œê·¸ë¨ ì„¤ì¹˜

### 2.1 SSH Server
```bash
apt-get update
apt-get install -y openssh-server
systemctl enable ssh.service
```

### 2.2 ë¶€íŒ… ëª¨ë“œ ì „í™˜ (GUI â†’ Text)
```bash
systemctl get-default
systemctl set-default multi-user.target   # Text ëª¨ë“œ
systemctl set-default graphical.target    # GUI ëª¨ë“œ
```

#### Text ëª¨ë“œì—ì„œë„ ë„¤íŠ¸ì›Œí¬ ì‚¬ìš© ì„¤ì •
`/etc/netplan/01-network-manager-all.yaml`
```yaml
network:
  version: 2
  renderer: NetworkManager
  ethernets:
    enp0s3:
      dhcp4: no
      addresses:
        - 10.100.0.100/16   # master
      routes:
        - to: default
          via: 10.100.0.1
      nameservers:
        addresses: [8.8.8.8, 8.8.4.4]
```
ì ìš©:
```bash
netplan apply
```

SSH ì§€ì—° ë¬¸ì œ í•´ê²°:
```bash
mkdir -p /etc/systemd/system/ssh.service.d
vi /etc/systemd/system/ssh.service.d/override.conf
```
ë‚´ìš©:
```
[Unit]
After=network-online.target
Wants=network-online.target
```
ì ìš©:
```bash
systemctl daemon-reload
systemctl restart ssh
systemctl enable ssh
```

---

## 3. Docker ì„¤ì¹˜

ê³µì‹ ê°€ì´ë“œ: [https://docs.docker.com/engine/install/ubuntu](https://docs.docker.com/engine/install/ubuntu)

```bash
apt-get update
apt-get install -y ca-certificates curl
install -m 0755 -d /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc
chmod a+r /etc/apt/keyrings/docker.asc
echo   "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc]   https://download.docker.com/linux/ubuntu $(. /etc/os-release && echo "${UBUNTU_CODENAME:-$VERSION_CODENAME}") stable" |   tee /etc/apt/sources.list.d/docker.list > /dev/null
apt-get update
apt-get install -y docker-ce docker-ce-cli containerd.io
systemctl enable docker
```

---

## 4. Kubernetes ì„¤ì¹˜

### 4.1 ì‚¬ì „ ì‘ì—…

#### a. Swap ë¹„í™œì„±í™”
```bash
swapoff -a
vi /etc/fstab  # /swapfile ë¼ì¸ ì£¼ì„ ì²˜ë¦¬
```

#### b. Iptables ë¸Œë¦¬ì§€ íŠ¸ë˜í”½ í—ˆìš©
```bash
vi /etc/sysctl.d/k8s.conf
```
ë‚´ìš©:
```
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
net.ipv4.ip_forward = 1
```
ì ìš©:
```bash
sysctl --system
```

#### c. ë°©í™”ë²½ ë¹„í™œì„±í™”
```bash
ufw disable
ufw allow 22/tcp
```

#### d. SSH Root ë¡œê·¸ì¸ í—ˆìš©
```bash
vi /etc/ssh/sshd_config
PermitRootLogin yes
systemctl restart sshd
```

---

### 4.2 Kubernetes ëŸ°íƒ€ì„ ì„¤ì¹˜

```bash
apt-get update
apt-get install -y apt-transport-https ca-certificates curl gpg
curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.30/deb/Release.key |   gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg
echo 'deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg]   https://pkgs.k8s.io/core:/stable:/v1.30/deb/ /'   | tee /etc/apt/sources.list.d/kubernetes.list
apt-get update
apt-get install -y kubelet kubeadm kubectl
apt-mark hold kubelet kubeadm kubectl
systemctl enable kubelet
```

---

## 5. Master Node ì„¤ì •

### 5.1 containerd ì„¤ì •
```bash
mv /etc/containerd/config.toml /etc/containerd/config.toml.bak
containerd config default | tee /etc/containerd/config.toml
sed -i 's/SystemdCgroup = false/SystemdCgroup = true/g' /etc/containerd/config.toml
systemctl restart containerd
crictl --runtime-endpoint unix:///var/run/containerd/containerd.sock version
```

### 5.2 í´ëŸ¬ìŠ¤í„° ì´ˆê¸°í™”
```bash
kubeadm init --pod-network-cidr=10.244.0.0/16
```

### 5.3 kubectl ì„¤ì •
```bash
mkdir -p $HOME/.kube
cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
chown $(id -u):$(id -g) $HOME/.kube/config
```

### 5.4 Flannel ì„¤ì¹˜
```bash
curl -O https://raw.githubusercontent.com/flannel-io/flannel/master/Documentation/kube-flannel.yml
vi kube-flannel.yml  # "Network" ê°’ì„ 10.244.0.0/16 ìœ¼ë¡œ ë§ì¶¤
kubectl apply -f kube-flannel.yml
rm kube-flannel.yml
```

### 5.5 ë…¸ë“œ í™•ì¸
```bash
kubectl get nodes -o wide
kubectl get pods --all-namespaces
```

---

## 6. Worker Node ì„¤ì •

### 6.1 ì»¤ë„ ëª¨ë“ˆ ì„¤ì •
```bash
vi /etc/modules-load.d/k8s.conf
```
ë‚´ìš©:
```
overlay
br_netfilter
vxlan
```

### 6.2 Master Node ì¡°ì¸
```bash
kubeadm join 10.100.0.100:6443 --token <í† í°> --discovery-token-ca-cert-hash sha256:<hash>
```

### 6.3 ì¡°ì¸ ì‹¤íŒ¨ ì‹œ ì´ˆê¸°í™”
```bash
kubeadm reset -f
systemctl restart containerd
systemctl restart kubelet
```

---

## 7. ì£¼ìš” ëª…ë ¹ì–´ ìš”ì•½

| ì‘ì—… | ëª…ë ¹ì–´ |
|------|--------|
| ë…¸ë“œ ëª©ë¡ | `kubectl get nodes -o wide` |
| íŒŒë“œ ëª©ë¡ | `kubectl get pods --all-namespaces` |
| íŒŒë“œ ìƒì„¸ | `kubectl describe pod <pod>` |
| ë¡œê·¸ í™•ì¸ | `kubectl -n <ns> logs <pod> --tail=100` |
| íŒŒë“œ ì‚­ì œ | `kubectl delete pod <pod>` |
| ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ìƒì„± | `kubectl create namespace myns` |

---

## 8. Pod ì‹¤í–‰ íŒ¨í„´

### 8.1 Sidecar
App ì»¨í…Œì´ë„ˆì— ë³´ì¡° ê¸°ëŠ¥ì„ ì¶”ê°€  
ì˜ˆ: ë¡œê·¸ ìˆ˜ì§‘  
```
App â†” Sidecar
```

### 8.2 Adapter
ì¶œë ¥ í¬ë§· ë³€í™˜ê¸°  
ì˜ˆ: ë©”íŠ¸ë¦­ ë³€í™˜  
```
App â†’ Adapter
```

### 8.3 Ambassador
ì™¸ë¶€ ì„œë¹„ìŠ¤ì™€ì˜ í†µì‹  í”„ë¡ì‹œ  
```
App â†’ Ambassador â†’ External Service
```

---

ğŸ“˜ **ì •ë¦¬ ì™„ë£Œ (2025 ë²„ì „)**  
ì´ ë¬¸ì„œëŠ” Master/Worker ë…¸ë“œ êµ¬ì„± ë° Kubernetes ì„¤ì¹˜ ê³¼ì •ì„ ìµœì‹  ê¸°ì¤€ìœ¼ë¡œ ì •ë¦¬í•œ ìš´ì˜ ê°€ì´ë“œì…ë‹ˆë‹¤.
